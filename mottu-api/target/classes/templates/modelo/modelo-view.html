<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{layout}">
<head>
    <title th:text="'Modelo ' + ${modelo.fabricante} + ' ' + ${modelo.nomeModelo} + ' - Mottu'">Modelo - Mottu</title>
</head>
<body>
<div layout:fragment="content">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">
                <i class="fas fa-cogs me-2 text-primary"></i>
                Detalhes do Modelo
            </h1>
            <p class="text-muted mb-0">
                Informações completas do modelo <strong th:text="${modelo.fabricante + ' ' + modelo.nomeModelo}">Honda CB600F</strong>
            </p>
        </div>
        <div>
            <a th:href="@{/modelos}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left me-2"></i>Voltar
            </a>
            <a th:href="@{/modelos/{id}/editar(id=${modelo.idModelo})}"
               class="btn btn-warning"
               sec:authorize="hasRole('ADMIN')">
                <i class="fas fa-edit me-2"></i>Editar
            </a>
        </div>
    </div>
    <div class="row">
        <!-- Informações Principais -->
        <div class="col-lg-8">
            <!-- Dados Básicos -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Especificações Técnicas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">Fabricante</label>
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-3"
                                     style="width: 50px; height: 50px;">
                                    <span th:text="${#strings.substring(modelo.fabricante, 0, 1).toUpperCase()}">H</span>
                                </div>
                                <div class="fs-5 fw-bold" th:text="${modelo.fabricante}">Honda</div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">Nome do Modelo</label>
                            <div class="fs-5 fw-bold" th:text="${modelo.nomeModelo}">CB600F</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">Cilindrada</label>
                            <div class="fs-4 text-primary">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                <span th:text="${modelo.cilindrada}">600</span>cc
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">Tipo/Categoria</label>
                            <div>
                                <span th:switch="${modelo.tipo}">
                                    <span th:case="'Esportiva'" class="badge bg-danger fs-6">
                                        <i class="fas fa-bolt me-1"></i>Esportiva
                                    </span>
                                    <span th:case="'Naked'" class="badge bg-primary fs-6">
                                        <i class="fas fa-motorcycle me-1"></i>Naked
                                    </span>
                                    <span th:case="'Scooter'" class="badge bg-info fs-6">
                                        <i class="fas fa-circle me-1"></i>Scooter
                                    </span>
                                    <span th:case="'Adventure'" class="badge bg-success fs-6">
                                        <i class="fas fa-mountain me-1"></i>Adventure
                                    </span>
                                    <span th:case="'Touring'" class="badge bg-warning fs-6">
                                        <i class="fas fa-road me-1"></i>Touring
                                    </span>
                                    <span th:case="*" class="badge bg-secondary fs-6" th:text="${modelo.tipo}">
                                        Tipo
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Análise Técnica -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>Análise Técnica
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label text-muted">Classificação por Cilindrada</label>
                            <div>
                                <span th:switch="${modelo.cilindrada}">
                                    <span th:case="#{modelo.cilindrada <= 125}" class="badge bg-info fs-6">
                                        <i class="fas fa-leaf me-1"></i>Baixa Cilindrada
                                    </span>
                                    <span th:case="#{modelo.cilindrada <= 300}" class="badge bg-primary fs-6">
                                        <i class="fas fa-balance-scale me-1"></i>Média Cilindrada
                                    </span>
                                    <span th:case="#{modelo.cilindrada <= 600}" class="badge bg-warning fs-6">
                                        <i class="fas fa-fire me-1"></i>Alta Cilindrada
                                    </span>
                                    <span th:case="*" class="badge bg-danger fs-6">
                                        <i class="fas fa-rocket me-1"></i>Super Esportiva
                                    </span>
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label text-muted">Uso Recomendado</label>
                            <div th:switch="${modelo.cilindrada}">
                                <div th:case="#{modelo.cilindrada <= 125}">Urbano / Iniciante</div>
                                <div th:case="#{modelo.cilindrada <= 300}">Urbano / Estrada</div>
                                <div th:case="#{modelo.cilindrada <= 600}">Estrada / Performance</div>
                                <div th:case="*">Performance / Pista</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label text-muted">Nível de Experiência</label>
                            <div th:switch="${modelo.cilindrada}">
                                <span th:case="#{modelo.cilindrada <= 125}" class="badge bg-success">Iniciante</span>
                                <span th:case="#{modelo.cilindrada <= 300}" class="badge bg-primary">Intermediário</span>
                                <span th:case="#{modelo.cilindrada <= 600}" class="badge bg-warning">Avançado</span>
                                <span th:case="*" class="badge bg-danger">Expert</span>
                            </div>
                        </div>
                    </div>

                    <!-- Características por Tipo -->
                    <div class="mt-4">
                        <h6>Características Típicas:</h6>
                        <ul class="list-unstyled">
                            <li th:switch="${modelo.tipo}">
                                <div th:case="'Esportiva'">
                                    <i class="fas fa-check text-success me-2"></i>Alta velocidade máxima<br>
                                    <i class="fas fa-check text-success me-2"></i>Excelente aerodinâmica<br>
                                    <i class="fas fa-check text-success me-2"></i>Performance em pista<br>
                                    <i class="fas fa-check text-success me-2"></i>Freios de alta performance
                                </div>
                                <div th:case="'Naked'">
                                    <i class="fas fa-check text-success me-2"></i>Versatilidade urbana<br>
                                    <i class="fas fa-check text-success me-2"></i>Conforto na pilotagem<br>
                                    <i class="fas fa-check text-success me-2"></i>Facilidade de manutenção<br>
                                    <i class="fas fa-check text-success me-2"></i>Boa relação custo-benefício
                                </div>
                                <div th:case="'Scooter'">
                                    <i class="fas fa-check text-success me-2"></i>Transmissão automática CVT<br>
                                    <i class="fas fa-check text-success me-2"></i>Excelente economia de combustível<br>
                                    <i class="fas fa-check text-success me-2"></i>Facilidade para iniciantes<br>
                                    <i class="fas fa-check text-success me-2"></i>Praticidade urbana
                                </div>
                                <div th:case="'Adventure'">
                                    <i class="fas fa-check text-success me-2"></i>Capacidade off-road<br>
                                    <i class="fas fa-check text-success me-2"></i>Conforto para viagens longas<br>
                                    <i class="fas fa-check text-success me-2"></i>Tanque de combustível grande<br>
                                    <i class="fas fa-check text-success me-2"></i>Proteção contra intempéries
                                </div>
                                <div th:case="*">
                                    <i class="fas fa-check text-success me-2"></i>Características específicas do tipo<br>
                                    <i class="fas fa-check text-success me-2"></i>Uso especializado
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Motos com este Modelo -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-motorcycle me-2"></i>Motos Cadastradas com este Modelo
                    </h5>
                    <div>
                        <span class="badge bg-primary me-2">
                            <span th:text="${modelo.motos != null ? modelo.motos.size() : 0}">0</span> motos
                        </span>
                        <a th:href="@{/motos/novo(modeloId=${modelo.idModelo})}"
                           class="btn btn-sm btn-outline-primary"
                           sec:authorize="hasAnyRole('ADMIN', 'OPERADOR')">
                            <i class="fas fa-plus me-1"></i>Nova Moto
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div th:if="${modelo.motos != null and !modelo.motos.isEmpty()}">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                <tr>
                                    <th>Placa</th>
                                    <th>Ano</th>
                                    <th>Status</th>
                                    <th>Pátio</th>
                                    <th>Sensor IoT</th>
                                    <th>Ações</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="moto : ${modelo.motos}">
                                    <td>
                                        <strong th:text="${moto.placa}">ABC1234</strong>
                                    </td>
                                    <td th:text="${moto.anoFabricacao}">2023</td>
                                    <td>
                                        <span th:switch="${moto.status}">
                                            <span th:case="'DISPONIVEL'" class="badge bg-success">Disponível</span>
                                            <span th:case="'ALUGADA'" class="badge bg-warning">Alugada</span>
                                            <span th:case="'MANUTENCAO'" class="badge bg-danger">Manutenção</span>
                                            <span th:case="*" class="badge bg-secondary" th:text="${moto.status}">Status</span>
                                        </span>
                                    </td>
                                    <td>
                                        <small th:text="${moto.patio != null ? moto.patio.nomePatio : 'Não definido'}">Pátio</small>
                                    </td>
                                    <td>
                                        <div th:if="${moto.sensorIot != null}">
                                            <span class="badge bg-info" th:text="${moto.sensorIot.tipoSensor}">GPS</span>
                                            <br>
                                            <small th:classappend="${moto.sensorIot.bateriaPercentual < 20 ? 'text-danger' : 'text-success'}"
                                                   th:text="${moto.sensorIot.bateriaPercentual} + '%'">85%</small>
                                        </div>
                                        <div th:if="${moto.sensorIot == null}">
                                            <span class="badge bg-secondary">Sem sensor</span>
                                        </div>
                                    </td>
                                    <td>
                                        <a th:href="@{/motos/{id}(id=${moto.idMoto})}"
                                           class="btn btn-sm btn-outline-info" title="Ver detalhes">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div th:if="${modelo.motos == null or modelo.motos.isEmpty()}"
                         class="text-center py-4 text-muted">
                        <i class="fas fa-motorcycle fa-3x mb-3"></i>
                        <p>Nenhuma moto cadastrada com este modelo</p>
                        <a th:href="@{/motos/novo(modeloId=${modelo.idModelo})}"
                           class="btn btn-primary"
                           sec:authorize="hasAnyRole('ADMIN', 'OPERADOR')">
                            <i class="fas fa-plus me-2"></i>Cadastrar primeira moto
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar - Informações Adicionais -->
        <div class="col-lg-4">
            <!-- Card Resumo -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Resumo do Modelo
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-3"
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-motorcycle fa-2x"></i>
                        </div>
                        <h4 th:text="${modelo.fabricante + ' ' + modelo.nomeModelo}">Honda CB600F</h4>
                        <p class="text-muted mb-0" th:text="${modelo.cilindrada + 'cc ' + modelo.tipo}">600cc Naked</p>
                    </div>

                    <!-- Estatísticas -->
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="border-end">
                                <h5 class="text-primary mb-0" th:text="${modelo.motos != null ? modelo.motos.size() : 0}">0</h5>
                                <small class="text-muted">Motos Ativas</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <h5 class="text-success mb-0" th:text="${modelo.cilindrada}">600</h5>
                            <small class="text-muted">Cilindrada (cc)</small>
                        </div>
                    </div>

                    <!-- Progress da frota -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small>Participação na Frota:</small>
                            <small th:text="${modelo.motos != null ? modelo.motos.size() : 0} + ' motos'">0 motos</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 25%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparação com Outros Modelos -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-balance-scale me-2"></i>Posicionamento
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-muted">Potência Estimada</label>
                        <div class="progress mb-1">
                            <div class="progress-bar"
                                 th:style="'width: ' + ${modelo.cilindrada / 10} + '%'"
                                 th:classappend="${modelo.cilindrada <= 125 ? 'bg-info' :
                                                  (modelo.cilindrada <= 300 ? 'bg-primary' :
                                                  (modelo.cilindrada <= 600 ? 'bg-warning' : 'bg-danger'))}">
                            </div>
                        </div>
                        <small class="text-muted" th:text="'Estimativa: ' + ${modelo.cilindrada * 0.8} + ' - ' + ${modelo.cilindrada * 1.2} + ' hp'">
                            Estimativa: 480 - 720 hp
                        </small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label text-muted">Adequação por Uso</label>
                        <div class="row">
                            <div class="col-6">
                                <small class="d-block">Urbano</small>
                                <div class="progress mb-1" style="height: 4px;">
                                    <div class="progress-bar bg-success"
                                         th:style="'width: ' + ${modelo.cilindrada <= 300 ? 90 : (modelo.cilindrada <= 600 ? 70 : 50)} + '%'"></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <small class="d-block">Estrada</small>
                                <div class="progress mb-1" style="height: 4px;">
                                    <div class="progress-bar bg-primary"
                                         th:style="'width: ' + ${modelo.cilindrada >= 300 ? 90 : 60} + '%'"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ações Rápidas -->
            <div class="card mb-4" sec:authorize="hasRole('ADMIN')">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>Ações Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a th:href="@{/modelos/{id}/editar(id=${modelo.idModelo})}" class="btn btn-outline-warning">
                            <i class="fas fa-edit me-2"></i>Editar Modelo
                        </a>
                        <a th:href="@{/motos/novo(modeloId=${modelo.idModelo})}" class="btn btn-outline-primary">
                            <i class="fas fa-plus me-2"></i>Cadastrar Moto
                        </a>
                        <a th:href="@{/motos?modeloId={id}(id=${modelo.idModelo})}" class="btn btn-outline-info">
                            <i class="fas fa-list me-2"></i>Ver Todas as Motos
                        </a>
                        <button type="button" class="btn btn-outline-danger"
                                th:onclick="'confirmarExclusao(' + ${modelo.idModelo} + ', \'' + ${modelo.fabricante} + ' ' + ${modelo.nomeModelo} + '\')'">
                            <i class="fas fa-trash me-2"></i>Excluir Modelo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Informações do Sistema -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info me-2"></i>Informações do Sistema
                    </h5>
                </div>
                <div class="card-body">
                    <small class="text-muted">
                        <div><strong>ID:</strong> <span th:text="${modelo.idModelo}">1</span></div>
                        <div><strong>Fabricante:</strong> <span th:text="${modelo.fabricante}">Honda</span></div>
                        <div><strong>Modelo:</strong> <span th:text="${modelo.nomeModelo}">CB600F</span></div>
                        <div><strong>Cilindrada:</strong> <span th:text="${modelo.cilindrada}">600</span>cc</div>
                        <div><strong>Tipo:</strong> <span th:text="${modelo.tipo}">Naked</span></div>
                        <div><strong>Motos Ativas:</strong> <span th:text="${modelo.motos != null ? modelo.motos.size() : 0}">0</span></div>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div class="modal fade" id="modalExclusao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                        Confirmar Exclusão
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir o modelo <strong id="nomeExclusao"></strong>?</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Atenção:</strong> Esta ação não pode ser desfeita e pode afetar motos cadastradas com este modelo.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                    <form id="formExclusao" method="post" style="display: inline;">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash me-2"></i>Excluir Modelo
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts específicos da página -->
<div layout:fragment="scripts">
    <script>
        function confirmarExclusao(id, nome) {
            document.getElementById('nomeExclusao').textContent = nome;
            document.getElementById('formExclusao').action = '/modelos/' + id;
            new bootstrap.Modal(document.getElementById('modalExclusao')).show();
        }
    </script>
</div>
</body>
</html>